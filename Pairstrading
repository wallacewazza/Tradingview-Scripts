

//========//
//If (percentrank > 0.90, create market neutral position)
//If (Percentrank < 0.10, close market neutral position)


//The thumb rule in the algorithm is when two highly correlated securities move away
//from their mean and distance reaches the highest 10% compared to last N number of
//days a long/short market neutral position is created and when the distance reaches the
//minimum 10%, the position is closed. For this paper we are taking N=200 days 
//========//



//2.3 Performance
//The performance of the algorithm is tested on two counts 1.Number of successful
//trades and 2. Return generated by trades 
//5
//3. Data
//This study encompasses over trading days from 1st January, 2004 to 30th June, 2012. The
////Closing price of gold and silver on MCX, India is considered.
//1. Closing prices from 1st January, 2004 to 31st December, 2007 is studied for
//correlation test.
//2. Closing prices from 1st January, 2008 to 30th June, 2012 is tested with the proposed
//algorithm.
//4. Results
//1. The correlation between the gold and silver prices for the period was found to be
//0.9640, which is greater then 0.90 and therefore gold/silver qualifies for pairs trading
//as per proposed rule.
//2. The algorithm triggered three positions during the test period.
//3. All positions generated positive returns with 100% accuracy.
//4. The positions delivered returns of 44.45%, with average positional profit of 14.82%.
//5. Silver delivered positive return in all three positions, where as gold delivered negative
//return in two positions out of three.
//5. Conclusion
//From the results we conclude that it is possible to create profitable market neutral
//positions with gold and silver. The algorithm we proposed in the paper has worked
//satisfactorily and can be further tested and utilized. We also conclude that correlation test
//satisfactorily helps in determining security pairs for pairs trading. We also conclude that
//stochastic method helps in finding entry and exit points for market neutral strategies.
//6. Scope for further research
//In this research we have only tested gold and silver to study the effectiveness of proposed
//algorithm. We have also tested the algorithm for stochastic period of 200 days. Further
//tests can be conducted with other securities and for different period to calculate
//percentage rank. 

//The strategy monitors performance of two historically correlated securities.



//When the correlation between the two securities temporarily weakens, i.e. one stock moves up while the other moves down,
//the pairs trade would be to short the outperforming stock and to long the underperforming one,
//betting that the "spread" between the two would eventually converge.[3]
//The divergence within a pair can be caused by temporary supply/demand changes, large buy/sell orders for one security,
//reaction for important news about one of the companies, and so on.




//Pairs trading strategy demands good position sizing, market timing, and decision making skill.
//Although the strategy does not have much downside risk, there is a scarcity of opportunities, 
//and, for profiting, the trader must be one of the first to capitalize on the opportunity.

//A notable pairs trader was hedge fund Long-Term Capital Management;[4] see Arbitrage#Dual-listed companies.




//@version=4
study(title="Pairs Trading", overlay=false, format=format.price)
sym = input("PEP"), res = timeframe.period, source = close
sym2 = input("KO")


x = security(sym, res, source)
y = security(sym2, res, source)

AverageA = (x+y)/2 

xx = x/AverageA
yy = y/AverageA

v = (xx/yy)

T = percentrank(v, 200)


plot(T, color=color.blue, linewidth=4, style=plot.style_stepline)

highline = hline(90)
lowline= hline(10)




































